<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.4.0/css/font-awesome.min.css">
<style>
#seat_con{
	width:960px;
	height:580px;
	border:1px solid #ccc;
	margin:auto;
	overflow:hidden;
}
#seat_cho{
	width:589px;
	height:530px;
	padding:25px 55px;
	float:left;
	background:#f5f5f5;
}
#seat_result{
	width:210px;
	height:530px;
	padding:25px;
	float:left;
}
ul,li{
	margin-top:10px;padding:0px;
}
ul li{
	list-style:none;
}
.seat_num_dd{
	color:black;
	text-align:center;
	line-height:50px;
	width: 62.2px;
	height: 50px;
	border: 1px orange dashed;
	display:inline-block;
}
#seat_num_choiced{
	    height: 208px;
			    overflow: auto;
	/*border:1px dashed gray;*/
	margin-top:10px;
}
#seat_sumbit{
	text-align:center;
	margin-top:25px;
}
input[type="submit"]{
	padding:10px 20px;
	background: orange;
	color: white;
	border-radius: 0.6rem;
	border:none;
	font-size: larger;
	cursor:pointer;
}
span.fa-check-circle{
	float: right;
	margin-top: 35px;
	color: orange;
	margin-left: -15px;
}
#seat_tips img{
	vertical-align:text-bottom;
	width:15px;
}
#seat_tips span{
	margin-right:10px;	
	vertical-align:middle;
}
#seat_tit{
	background: gray;
	color: white;
	text-align: center;
	padding: 10px 0px;
}
#seat_tips{
	text-align: center;
	padding: 10px 0px;
}
#seat_detail{
	width: 587px;
	height: 446px;
	text-align: center;
}
.numIcon {
	display: inline-block;
	width: 20px;
	vertical-align: middle;
	background: #bcbdc3;
	color: white;
	border-radius: 1rem;
	padding: 5px;
	text-align: center;
	height: 20px;
	line-height: 24px;
}
.sofa{
	vertical-align:middle;
	cursor:pointer;
}
#seat_none{
	padding: 15px 10px;
}
#seat_none small{
	color:gray;	
}
input.un_submit{
	background:#c5c3c3;
	color:#fff;
}
</style>
</head>
<body>
<div id="seat_con">
	<div id="seat_cho">
		<div id="seat_tit">
			贵州省麻江县多彩贵州舞蹈大赛
		</div>
		<div id="seat_tips">
			<span id="unchoice"><img src="icons/unchoice.svg" alt=""><span class="text">可选座位</span></span><span id="choice"><img src="icons/choice.svg" alt=""><span class="text">已选座位</span></span><span id="sales"><img src="icons/sales.svg" alt=""><span class="text">已售座位</span></span>
		</div>
		<div id="seat_detail">
		</div>
	</div>
	<div id="seat_result">
		<h4>您的购票信息</h4>
		<ul id="seat_info">
			<li><span>项目：</span>麻江多彩贵州舞蹈大赛</li>
			<li><span>地址：</span>麻江县电影院</li>
			<li><span>日期：</span>2016-8-1</li>
			<li><span>时间：</span>09:00-17:00</li>
		</ul>			
		<div id="seat_num">
			<dt>座位：</dt>
			<div id="seat_num_choiced">
				<div id="seat_none"><strong>未选择座位</strong><br /><small>请先在左侧选座</small></div>
			</div>
		</div>
		<div id="seat_sumbit" ><input id="buy" class="un_submit" type="submit" value="立即购买" /></div>
	</div>
</div>
<script>
var $ = function (id){
	return document.getElementById(id);
};

var $c = function(classname){
	return document.getElementsByClassName(classname);
};
var buyBtn = $("buy");
var seatChoiced = $("seat_num_choiced");
var	seatDe = document.getElementById("seat_detail"); 	//座位区域	
var seatNum = 251;									//座位
var rows = 1;
var seatNone = $("seat_none");
var sofaType = {"unchoice":"icons/unchoice.svg","choiced":"icons/choice.svg","sold":"icons/sales.svg"};
var seatArr = {
chose:[],
sold:[]
};
window.addEventListener("load",mkSeat,false);			//载入后，自动创建座位
buyBtn.addEventListener("click",success,false);

function mkSeat(){									//批量创建元素	
	for(var i = 0;i<=seatNum;i++){
		if(i%18==0){
			var span = document.createElement("span");	
			span.className = "numIcon";
			span.innerHTML = rows;
			seatDe.appendChild(span);
			rows+=1;
		}else{
			var sofa = document.createElement("img");	
			sofa.src=sofaType.unchoice;
			sofa.className="sofa";
			sofa.title=rows-1 + "排" + i%18 + "号";
			sofa.chOff = true;  //先设置为可选模式
			sofa.addEventListener("click",choice,false);		//绑定点击沙发的事件
			seatArr.chose.push(sofa.title);    //推送到可选数组
			seatDe.appendChild(sofa);
		}
	};
};

var sofa = $c("sofa");
var choicedArr = [];
var caNum = -1;
var caSum = 0;


function choice(){
	if(this.chOff){
		caNum++;
		this.src = sofaType.choiced;				//改变已选模式的图标	
		this.chOff = false;
		choicedArr.push(this.title);				//向数组推送元素
		this.num =	caNum; 									//为事件元素设置属性与数组下标同步
		var	seatDD = document.createElement("div"); 
		seatDD.className = "seat_num_dd";
		seatDD.id = this.num;
		seatDD.innerHTML = "<small>" + this.title + "</small>" + "<span class=\"fa fa-check-circle\"></span>";
		seatChoiced.appendChild(seatDD);
		seatNone.style.display = "none";		//点击位置，卸载默认样式
		buyBtn.removeAttribute("class");		//点击位置，卸载默认样式
	}else{
		this.src = sofaType.unchoice;       //改变为未选模式的图标	
		this.chOff = true;
		delete choicedArr[this.num];				//删除元素下标位置的数组元素
		seatChoiced.removeChild($(this.num));
		if(seatChoiced.childNodes.length==3){			//判断已选择位置的容器下的子节点长度为3,就是空，进行逻辑动作
			seatNone.style.display = "block";				//为空，恢复默认样式
			buyBtn.setAttribute("class","un_submit");   //为空，恢复默认样式				
		};
	};
};

function success(){
		choicedArr.forEach(function (e){seatArr.sold.push(e)});			//推送数据到已经购买的数组
		seatArr.sold.forEach(function (e){
				sofa[seatArr.chose.indexOf(e)].src=sofaType.sold;				//绑定已购买的数组调用到可选择的数组找出序列引用到所有沙发的位置进行更改
				sofa[seatArr.chose.indexOf(e)].removeEventListener("click",choice,false);					//解除点击事件的绑定
		//console.log(sofa[seatArr.chose.indexOf(e)].status);
				});
		//console.log(seatArr.sold);
		choicedArr.splice(0,choicedArr.length);
		console.log(choicedArr);
		seatChoiced.innerHTML = "";
		seatChoiced.appendChild(seatNone);
		seatNone.style.display = "block";				//为空，恢复默认样式
		this.setAttribute("class","un_submit");   //为空，恢复默认样式				
		console.log(seatArr.sold);
}
</script>
</body>
</html>
